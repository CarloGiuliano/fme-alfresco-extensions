if(typeof(fme)=="undefined"){fme={};}if(typeof(fme.dashlet)=="undefined"){fme.dashlet={};}if(typeof(fme.module)=="undefined"){fme.module={};}(function(){var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event;var $html=Alfresco.util.encodeHTML,$combine=Alfresco.util.combinePaths;fme.dashlet.topx=function topx_constructor(htmlId){return fme.dashlet.topx.superclass.constructor.call(this,"fme.dashlet.topx",htmlId);};YAHOO.extend(fme.dashlet.topx,Alfresco.component.Base,{options:{componentId:"",maxItems:10},documentsList:null,title:null,onReady:function topx_onReady(){var me=this;this.title=Dom.get(this.id+"-title");this.documentsList=Dom.get(this.id+"-documentsList");this.load();},load:function topx_load(){Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.PROXY_URI+"/de/fme/dashlet/topx/find?queryType=d&maxItems="+this.options.maxItems,successCallback:{fn:this.onLoadSuccess,scope:this,obj:null},failureCallback:{fn:this.onLoadFailure,scope:this},scope:this,noReloadOnAuthFailure:true});},onLoadSuccess:function topx_onLoadSuccess(p_response,p_obj){this.title.innerHTML=this.msg("header.title",this.options.maxItems);var html="";if(p_response.json){documents=p_response.json;this.currentThumbnails=p_response.json;if(documents.length>0){html+=this._generateDocumentsHTML(documents);}else{html+='<div class="detail-list-item first-item last-item">\n';html+="<span>\n";html+=this.msg("list.noDocuments");html+="</span>\n";html+="</div>\n";}}this.documentsList.innerHTML=html;},onLoadFailure:function topx_onLoadFailure(p_response,p_obj){this.documentsList.innerHTML='<div class="msg">'+this.msg("label.error")+"</div>";},_generateDocumentsHTML:function topx__generateDocumentsHTML(documents){var lastHits=0;var lastPlace=0;var html="";for(var i=0;i<documents.length;i++){var place=i;if(lastHits==documents[i].hitCount){place=lastPlace;}html+=this._generateDocumentHTML(documents[i],i,place);lastPlace=i;lastHits=documents[i].hitCount;}return html;},_generateDocumentHTML:function topx__generateDocumentHTML(doc,i,place){var html="";var icon;var background=$html(Alfresco.constants.PROXY_URI)+"api/node/workspace/SpacesStore/"+doc.nodeRefId+"/content/thumbnails/doclib?c=queue&amp;ph=true)";if(place==0){icon=Alfresco.constants.URL_RESCONTEXT+"fme/components/dashlets/images/first_place.gif";}else{if(place==1){icon=Alfresco.constants.URL_RESCONTEXT+"fme/components/dashlets/images/second_place.gif";}else{if(place==2){icon=Alfresco.constants.URL_RESCONTEXT+"fme/components/dashlets/images/third_place.gif";}else{icon=Alfresco.constants.URL_RESCONTEXT+"fme/components/dashlets/images/other_places.gif";}}}html+='<div class="topx-doc">\n';html+='<div class="thumbnail">\n <ul id="pics"><li><a class="viewImageAction" href="'+doc.nodeRefId+'"><img src="'+icon+'" style="background: url('+background+';background-repeat:no-repeat " width="75px" title="'+(place+1)+'. place"/></a></li></ul></div>\n';html+='<div class="pictures">';html+='<a href="'+$html(Alfresco.constants.PROXY_URI)+"api/node/content/workspace/SpacesStore/"+doc.nodeRefId+"/"+doc.name+'?a=true"><img title="'+doc.contentMimetype+" - "+doc.contentSizeFormatted+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/download-16.png"/></a></br>';html+='<a href="'+$html(Alfresco.constants.URL_PAGECONTEXT)+"site/"+doc.siteName+"/documentlibrary#filter=path%7C"+doc.sitePath+'"><img id="downloadInfo" title="'+doc.displayPath+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-open-16.png"/></a>';html+="</div>\n";html+='<div class="document">\n';html+="<div>\n";var documentDetailsUrl=$html(Alfresco.constants.URL_PAGECONTEXT)+"site/"+doc.siteName+"/document-details?nodeRef="+doc.nodeRef;if(doc.title){title=doc.abbreviatedTitle;fullTitle=doc.title;}else{title=doc.abbreviatedName;fullTitle=doc.name;}html+='<span title="'+fullTitle+'" class="doc-title"><a href="'+documentDetailsUrl+' ">'+title+"</a></span>";html+="</div>\n";var userpageCreator=Alfresco.constants.URL_PAGECONTEXT+"user/"+doc.creator+"/profile";var userpageModifier=Alfresco.constants.URL_PAGECONTEXT+"user/"+doc.modifier+"/profile";html+="<div>"+doc.hitCount+" Hits</div>\n";html+='<div class="doc-details"> created '+doc.creationDate+' by <a href="'+userpageCreator+'">'+doc.creatorFormatted+"</a><br/>modified "+doc.modifyDate+' by <a href="'+userpageModifier+'">'+doc.modifierFormatted+"</a></div>\n";html+="</div>\n";html+="</div>\n";return html;}});})();